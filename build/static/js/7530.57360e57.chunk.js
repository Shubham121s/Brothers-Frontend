"use strict";(self.webpackChunkBrother_Industrises=self.webpackChunkBrother_Industrises||[]).push([[7530],{18091:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});a(49934);var s=a(65043),r=a(34960);const n=a.p+"static/media/wallpaper.bded4f44087fb4e89252.png";var d=a(79456),l=a(80907),i=a(76416);const o=(0,l.zD)("task/data/get/chatById",async e=>{try{return await(0,i.Ei)(e)}catch(t){return null===t||void 0===t?void 0:t.response}}),c=(0,l.zD)("task/data/get/user/status",async e=>{try{return await(0,i.aO)(e)}catch(t){return null===t||void 0===t?void 0:t.response}}),u=(0,l.zD)("task/data/post/chat",async e=>{try{return await(0,i.Jt)(e)}catch(t){return null===t||void 0===t?void 0:t.response}}),f=(0,l.Z0)({name:"chat/data",initialState:{loading:!1,chatByIdList:[],userStatus:"Offline",tableData:{total:0,pageIndex:1,pageSize:10,query:""}},reducers:{setTableData:(e,t)=>{e.tableData=t.payload}},extraReducers:{[o.fulfilled]:(e,t)=>{var a;e.chatByIdList=(null===(a=t.payload.data)||void 0===a?void 0:a.data)||[],e.tableData.total=t.payload.data.total||0,e.loading=!1},[o.pending]:(e,t)=>{e.loading=!0},[u.fulfilled]:(e,t)=>{},[c.fulfilled]:(e,t)=>{e.userStatus=t.payload.data.data||"Offline"}}}),{setTableData:h,setFilterData:p}=f.actions,g=f.reducer;var m=a(73216);const y=a.p+"static/media/profile.cfe9f79c746ba3002568.jpg";var v=a(70579);const x=()=>{var e;const t=(0,d.wA)(),a=(0,m.zy)(),[l,i]=(0,s.useState)([]),[f,h]=(0,s.useState)(""),p=(0,d.d4)(e=>e.auth.user.user_id),g=(0,d.d4)(e=>e.chat.data.chatByIdList),x=(0,d.d4)(e=>e.chat.data.userSatus),w=(0,d.d4)(e=>e.socket.instance),b=null===(e=a.state)||void 0===e?void 0:e.record,k=(0,s.useRef)(null);(0,s.useEffect)(()=>{t(o({task_id:b.task_id})),t(c({user_id:b.assigned_to}))},[t]),(0,s.useEffect)(()=>{if(!w)return;const e=e=>{var t;console.log("Received message:",e);const a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.dataValues;a&&i(e=>[...e,{task_id:a.task_id||null,receiver_id:a.receiver_id||null,sender_id:a.sender_id||null,message:a.message||"",id:a.task__chat_id||Date.now()}])};return w.on("Reply",e),()=>{w.off("Reply",e)}},[w]),(0,s.useEffect)(()=>{g&&i(g)},[g]),(0,s.useEffect)(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},[l]);const _=()=>{if(""===f.trim())return;const e={task_id:b.task_id,receiver_id:b.assigned_to===p?b.assigned_by:b.assigned_to,sender_id:p,message:f};t(u({...e})),i(t=>[...t,e]),h("")};return(0,v.jsxs)("div",{className:"flex flex-col h-80 max-w-lg mx-auto bg-white rounded-lg overflow-hidden",children:[(0,v.jsx)("header",{className:"p-4 bg-green-600 text-white text-lg font-semibold flex items-center shadow-md",children:(0,v.jsxs)("div",{className:"flex items-center",children:[(0,v.jsx)("img",{src:y,alt:"Profile",className:"w-12 h-12 rounded-full mr-2"}),(0,v.jsxs)("div",{children:[(0,v.jsx)("span",{children:b.assigned_to===p?`${b["AssignedBy.name"]}`:`${b["AssignedTo.name"]}`}),(0,v.jsx)("br",{}),(0,v.jsx)("span",{className:"text-sm",children:x})]})]})}),(0,v.jsx)("main",{ref:k,className:"flex-1 overflow-y-auto p-4 h-full bg-cover bg-center",style:{backgroundImage:`url(${n})`},children:l.map(e=>(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"flex mb-4 "+(e.sender_id===p?"justify-end":"justify-start"),children:(0,v.jsx)("div",{className:`max-w-xs p-3 rounded-lg text-white ${e.sender_id===p?"bg-green-500 text-right":"bg-green-500 text-black"} transition duration-200 ease-in-out shadow-md ${e.sender_id===p?"round-l text-left":"round-r text-left"}`,style:{wordWrap:"break-word",wordBreak:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},children:e.message})},e.id)}))}),(0,v.jsxs)("footer",{className:"p-4 w-full bg-gray-100 border-t shadow-md flex justify-between gap-2",children:[(0,v.jsx)("div",{className:"w-95 border border-gray-300 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-200",children:(0,v.jsx)("input",{type:"text",value:f,onChange:e=>h(e.target.value),placeholder:"Type your message...",className:"w-full h-full p-4 focus-outline-none",onKeyDown:e=>{"Enter"===e.key&&_()}})}),(0,v.jsx)("div",{className:"flex justify-center text-xl rounded-full bg-green-600 text-white w-12 h-12 hover:bg-green-700 transition duration-200",children:(0,v.jsx)("button",{onClick:_,className:"",children:(0,v.jsx)(r.ylI,{})})})]})]})};var w=a(24603),b=a(50805);const k=(0,l.Z0)({name:"chat/state",initialState:{selectedChat:{}},reducers:{setSelectedChat:(e,t)=>{e.selectedChat=t.payload}}}),{setSelectedChat:_}=k.actions,j=k.reducer,D=(0,b.HY)({data:g,state:j});(0,w.Mh)("chat",D);const N=()=>(0,v.jsx)("div",{children:(0,v.jsx)(x,{})})},76416:(e,t,a)=>{a.d(t,{Ei:()=>o,Jt:()=>c,RU:()=>l,aO:()=>u,fb:()=>r,j1:()=>i,oB:()=>n,oG:()=>d});var s=a(43971);async function r(e){return s.A.fetchData({url:"v1/web/company/task",method:"post",data:e})}async function n(e){return s.A.fetchData({url:"v1/web/company/task/register",method:"post",data:e})}async function d(){return s.A.fetchData({url:"v1/web/company/user/option",method:"post"})}async function l(e){return s.A.fetchData({url:"v1/web/company/task/update/id",method:"put",data:e})}async function i(e){return s.A.fetchData({url:"v1/web/company/task/delete/id",method:"delete",data:e})}async function o(e){return s.A.fetchData({url:"v1/web/company/task/chat",method:"post",data:e})}async function c(e){return s.A.fetchData({url:"v1/web/company/task/chat/register",method:"post",data:e})}async function u(e){return s.A.fetchData({url:"v1/web/company/task//user/status",method:"post",data:e})}}}]);
//# sourceMappingURL=7530.57360e57.chunk.js.map